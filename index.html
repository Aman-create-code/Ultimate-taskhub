<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniCloud OS | Professional Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        :root { --primary: #3b82f6; --bg: #020617; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; overflow: hidden; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .sidebar-btn.active { background: rgba(59, 130, 246, 0.1); border-left: 4px solid var(--primary); color: white; }
        .upload-area.drag { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
        
        /* Custom Animations */
        @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .loading-pulse { animation: pulse-soft 2s infinite; }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex">

    <div id="lockScreen" class="fixed inset-0 z-[999] bg-slate-950 flex items-center justify-center p-6 hidden">
        <div class="max-w-md w-full glass p-10 rounded-[3rem] text-center">
            <div class="w-20 h-20 bg-blue-600/20 rounded-3xl flex items-center justify-center mx-auto mb-6">
                <i data-lucide="shield-check" class="text-blue-500 w-10 h-10"></i>
            </div>
            <h2 class="text-3xl font-black mb-2">Cloud Lock</h2>
            <p class="text-slate-500 mb-8">Eingabe deines GitHub Tokens erforderlich.</p>
            <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxx" class="w-full bg-slate-900 border border-slate-800 rounded-2xl p-4 mb-4 outline-none focus:border-blue-500 transition-all">
            <button onclick="unlock()" class="w-full bg-blue-600 py-4 rounded-2xl font-bold hover:bg-blue-500 transition-all shadow-xl shadow-blue-600/20">System entsperren</button>
        </div>
    </div>

    <aside class="w-72 glass border-r border-white/5 flex flex-col p-6 hidden lg:flex">
        <div class="flex items-center gap-3 mb-12 px-2">
            <div class="bg-blue-600 p-2 rounded-lg"><i data-lucide="box" class="w-6 h-6"></i></div>
            <h1 class="text-xl font-black tracking-tighter">OMNI<span class="text-blue-500">CLOUD</span></h1>
        </div>

        <nav class="space-y-1 flex-1">
            <p class="text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-4 ml-2">Module</p>
            <button onclick="changeModule('ARCHIVE', this)" class="sidebar-btn active w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white transition-all">
                <i data-lucide="archive" class="w-5 h-5"></i> Archive Lab
            </button>
            <button onclick="changeModule('IMAGE', this)" class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white transition-all">
                <i data-lucide="image" class="w-5 h-5"></i> Image Engine
            </button>
            <button onclick="changeModule('VIDEO', this)" class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white transition-all">
                <i data-lucide="video" class="w-5 h-5"></i> Video Studio
            </button>
            <button onclick="changeModule('DOCS', this)" class="sidebar-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white transition-all">
                <i data-lucide="file-text" class="w-5 h-5"></i> Document Pro
            </button>
        </nav>

        <div class="mt-auto p-4 bg-slate-900/50 rounded-2xl border border-white/5">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-[10px] font-bold uppercase text-slate-400">API Connection OK</span>
            </div>
            <button onclick="clearToken()" class="text-[10px] text-red-500 font-bold hover:underline">Token löschen</button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-6 md:p-12">
        <div class="max-w-5xl mx-auto space-y-10">
            
            <div class="flex justify-between items-end">
                <div>
                    <h2 id="modTitle" class="text-5xl font-black italic tracking-tighter uppercase">Archive Lab</h2>
                    <p class="text-slate-500 mt-2">Upload -> Processing -> Cloud Release</p>
                </div>
                <div id="globalStatus" class="hidden flex items-center gap-3 bg-blue-600/10 border border-blue-500/20 px-6 py-3 rounded-2xl text-blue-400 font-bold">
                    <i data-lucide="loader-2" class="animate-spin w-4 h-4"></i>
                    Cloud arbeitet... <span id="clock" class="font-mono ml-2">00:00</span>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-10">
                
                <div class="xl:col-span-2 space-y-6">
                    <div class="glass p-8 rounded-[3rem]">
                        <div class="flex items-center gap-4 mb-8">
                            <span class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-sm">1</span>
                            <h3 class="text-xl font-bold">Datei vorbereiten</h3>
                        </div>

                        <div id="dropZone" class="upload-area relative group border-2 border-dashed border-slate-800 rounded-[2rem] p-16 text-center transition-all cursor-pointer hover:border-blue-500/30">
                            <input type="file" id="fileInput" class="hidden">
                            <div class="group-hover:scale-110 transition-transform duration-500">
                                <i data-lucide="upload-cloud" class="w-16 h-16 text-slate-700 mx-auto mb-4 group-hover:text-blue-500"></i>
                            </div>
                            <p id="fileLabel" class="text-lg font-bold text-slate-500 group-hover:text-slate-300">Zieh eine Datei hierher oder klicke</p>
                            <p class="text-xs text-slate-600 mt-2 italic">Maximal 100MB pro File empfohlen</p>
                        </div>
                    </div>

                    <div class="glass p-8 rounded-[3rem]">
                        <div class="flex items-center gap-4 mb-8">
                            <span class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-sm">2</span>
                            <h3 class="text-xl font-bold">Operation wählen</h3>
                        </div>

                        <div id="toolsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            </div>

                        <button id="startBtn" onclick="initiateCloudProcess()" class="w-full mt-10 bg-white text-black py-5 rounded-[2rem] font-black text-xl flex items-center justify-center gap-4 hover:bg-blue-600 hover:text-white transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-2xl">
                            <i data-lucide="zap" class="fill-current"></i> PROZESS STARTEN
                        </button>
                    </div>
                </div>

                <div class="space-y-6">
                    <h3 class="text-sm font-black uppercase tracking-[0.2em] text-slate-500 ml-4">Cloud Results</h3>
                    <div id="history" class="space-y-4 overflow-y-auto max-h-[700px] pr-2">
                        </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();

        const CONFIG = {
            user: "Aman-create-code",
            repo: "YouTube-downloader",
            workflow: "hub-task.yml"
        };

        const MODULES = {
            ARCHIVE: [
                { id: 'zip_all', name: 'ZIP Kompression', desc: 'Packt alles zusammen', icon: 'package' },
                { id: 'rar_to_zip', name: 'RAR zu ZIP', desc: 'Konvertierung', icon: 'file-archive' },
                { id: 'encrypt_zip', name: 'Secure ZIP', desc: 'Passwort: Cloud123', icon: 'lock' }
            ],
            IMAGE: [
                { id: 'webp_80', name: 'WebP Optimizer', desc: 'Maximale Ersparnis', icon: 'zap' },
                { id: 'resize_50', name: 'Resize 50%', desc: 'Dimensionen halbiert', icon: 'minimize-2' },
                { id: 'bw_filter', name: 'B&W Filter', desc: 'Graustufen Konvertierung', icon: 'palette' }
            ],
            VIDEO: [
                { id: 'mp4_to_gif', name: 'Video zu GIF', desc: 'Animierte Loops', icon: 'play' },
                { id: 'compress_video', name: 'Kompression', desc: 'Dateigröße verringern', icon: 'film' },
                { id: 'extract_audio', name: 'Audio Extrahieren', desc: 'MP3 Output', icon: 'music' }
            ],
            DOCS: [
                { id: 'merge_pdf', name: 'PDF Merge', desc: 'Dateien zusammenfügen', icon: 'layers' },
                { id: 'docx_to_pdf', name: 'Office zu PDF', desc: 'Format Konvertierung', icon: 'file-text' },
                { id: 'clean_exif', name: 'Meta Data Wipe', desc: 'Anonymisierung', icon: 'shield' }
            ]
        };

        let currentFile = null;
        let selectedTool = null;
        let activeMod = 'ARCHIVE';

        // STARTUP
        window.onload = () => {
            if(!localStorage.getItem('gh_token')) {
                document.getElementById('lockScreen').classList.remove('hidden');
            } else {
                renderTools();
                fetchHistory();
            }
        };

        function unlock() {
            const token = document.getElementById('tokenInput').value;
            if(token.startsWith('ghp_')) {
                localStorage.setItem('gh_token', token);
                location.reload();
            } else { alert("Ungültiger Token!"); }
        }

        function clearToken() { localStorage.removeItem('gh_token'); location.reload(); }

        // MODULE LOGIC
        function changeModule(mod, btn) {
            activeMod = mod;
            document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('modTitle').innerText = mod + " Lab";
            renderTools();
        }

        function renderTools() {
            const grid = document.getElementById('toolsGrid');
            grid.innerHTML = MODULES[activeMod].map(tool => `
                <div onclick="selectTool('${tool.id}', this)" class="tool-card glass p-6 rounded-3xl cursor-pointer border border-white/5 hover:border-blue-500 transition-all group">
                    <div class="w-12 h-12 bg-slate-800 rounded-2xl flex items-center justify-center mb-4 group-hover:bg-blue-600 transition-colors">
                        <i data-lucide="${tool.icon}" class="w-6 h-6"></i>
                    </div>
                    <h4 class="font-bold">${tool.name}</h4>
                    <p class="text-[10px] text-slate-500 mt-1">${tool.desc}</p>
                </div>
            `).join('');
            lucide.createIcons();
            selectedTool = null;
        }

        function selectTool(id, el) {
            document.querySelectorAll('.tool-card').forEach(c => c.style.borderColor = 'rgba(255,255,255,0.05)');
            el.style.borderColor = '#3b82f6';
            selectedTool = id;
        }

        // FILE HANDLING
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        function handleFile(file) {
            if(!file) return;
            currentFile = file;
            document.getElementById('fileLabel').innerText = file.name;
            document.getElementById('fileLabel').classList.replace('text-slate-500', 'text-blue-400');
        }

        // THE CORE PROCESS
        async function initiateCloudProcess() {
            if(!currentFile || !selectedTool) return alert("Datei und Operation wählen!");
            const token = localStorage.getItem('gh_token');
            const btn = document.getElementById('startBtn');
            const status = document.getElementById('globalStatus');

            btn.disabled = true;
            status.classList.remove('hidden');
            startClock();

            try {
                // 1. UPLOAD
                const reader = new FileReader();
                reader.readAsDataURL(currentFile);
                reader.onload = async () => {
                    const base64 = reader.result.split(',')[1];
                    await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/input/${currentFile.name}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: JSON.stringify({ message: "Web-Upload", content: base64 })
                    });

                    // 2. DISPATCH
                    await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/actions/workflows/${CONFIG.workflow}/dispatches`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}`, 'Accept': 'application/vnd.github+json' },
                        body: JSON.stringify({ ref: 'main', inputs: { task_type: selectedTool } })
                    });

                    pollReleases(token);
                };
            } catch (e) { alert("Fehler im Ablauf"); stopClock(); }
        }

        async function pollReleases(token) {
            const check = async () => {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/releases`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if(data[0] && (new Date() - new Date(data[0].created_at)) < 40000) {
                    stopClock();
                    fetchHistory();
                    alert("CLOUD TASK COMPLETE!");
                    document.getElementById('startBtn').disabled = false;
                } else { setTimeout(check, 5000); }
            };
            check();
        }

        async function fetchHistory() {
            const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/releases`);
            const data = await res.json();
            document.getElementById('history').innerHTML = data.slice(0, 10).map(rel => `
                <div class="glass p-5 rounded-3xl border-l-4 border-blue-600 animate-in fade-in duration-500">
                    <p class="text-[9px] font-mono text-slate-500 mb-2 uppercase">${new Date(rel.created_at).toLocaleString()}</p>
                    <h5 class="text-xs font-bold truncate mb-4">${rel.name}</h5>
                    <a href="${rel.assets[0]?.browser_download_url}" class="block text-center bg-slate-800 py-2 rounded-xl text-[10px] font-bold hover:bg-white hover:text-black transition-all">DOWNLOAD</a>
                </div>
            `).join('');
        }

        let clockInt;
        function startClock() {
            let s = 0;
            clockInt = setInterval(() => {
                s++;
                const min = Math.floor(s/60).toString().padStart(2, '0');
                const sec = (s%60).toString().padStart(2, '0');
                document.getElementById('clock').innerText = min + ":" + sec;
            }, 1000);
        }
        function stopClock() {
            clearInterval(clockInt);
            document.getElementById('globalStatus').classList.add('hidden');
        }
    </script>
</body>
</html>
